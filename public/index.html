<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            line-height: 1.6;
        }
        table {
            width: 100%; /* Full width */
            border-spacing: 20px; /* Space between cells */
        }
        td {
            vertical-align: top; /* Align content at the top */
            width: 50%; /* Each column takes half the width */
        }
        .card {
            border: 2px solid #ccc; /* Thicker border for better visibility */
            border-radius: 10px; /* Slightly larger border radius */
            padding: 20px; /* Increased padding */
            text-align: center;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card h2 {
            margin-bottom: 15px; /* Increased spacing below heading */
            font-size: 24px; /* Larger font size for headings */
        }
        .status {
            font-size: 20px; /* Larger font size for statuses */
            font-weight: bold;
            margin-bottom: 15px; /* Increased spacing below status */
        }
        .button {
            display: inline-block;
            padding: 15px 30px; /* Larger button size */
            font-size: 20px; /* Larger button text */
            color: #fff;
            background-color: #007BFF; /* Blue button */
            border: none;
            border-radius: 8px; /* Slightly larger border radius for buttons */
            cursor: pointer;
        }
        .button:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }
    </style>
</head>
<body>
    <table>
        <tr>
            <!-- Lumière Cour -->
            <td>
                <div class="card" id="cour-card">
                    <h2>Lumière Cour</h2>
                    <div class="status">État : <span id="state-cour">Chargement...</span></div>
                    <button class="button" id="toggle-cour">Basculer</button>
                </div>
            </td>

            <!-- Portail -->
            <td>
                <div class="card" id="gate-card">
                    <h2>Portail</h2>
                    <div class="status">État : <span id="state-gate">Chargement...</span></div>
                    <button class="button" id="toggle-gate">Actionner portail</button>
                </div>
            </td>
        </tr>

        <tr>
            <!-- Lumière Cuisine -->
            <td colspan="2">
                <div class="card" id="cuisine-card">
                    <h2>Lumière Cuisine</h2>
                    <div class="status">État : <span id="state-cuisine">Chargement...</span></div>
                    <button class="button" id="toggle-cuisine">Basculer</button>
                </div>
            </td>
        </tr>
    </table>

    <!-- Inline JavaScript -->
    <script>
      function updateState(entityKey, stateElementId) {
          var xhr = new XMLHttpRequest();
          xhr.open('GET', '/get-state?entity=' + entityKey, true);
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  var data = JSON.parse(xhr.responseText);
                  // Transform "on" to "ouvert" and "off" to "fermé" for the gate
                  if (entityKey === 'gate_sensor') {
                      document.getElementById(stateElementId).textContent =
                          data.state === 'on' ? 'ouvert' : 'fermé';
                  } else {
                      document.getElementById(stateElementId).textContent = data.state || 'Inconnu';
                  }
              }
          };
          xhr.send();
      }

      function toggleEntity(entityKey, stateElementId) {
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/toggle-light', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  var result = JSON.parse(xhr.responseText);
                  document.getElementById(stateElementId).textContent = result.new_state || 'Inconnu';
              }
          };
          xhr.send(JSON.stringify({ entity: entityKey }));
      }

      function toggleGate() {
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/toggle-gate', true);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                  var result = JSON.parse(xhr.responseText);
                  document.getElementById('state-gate').textContent =
                      result.gate_state === 'on' ? 'ouvert' : 'fermé';
              }
          };
          xhr.send();
      }

      // Event Listeners for Lumière Cuisine
      document.getElementById('toggle-cuisine').onclick = function () {
          toggleEntity('cuisine', 'state-cuisine');
      };

      // Event Listeners for Lumière Cour
      document.getElementById('toggle-cour').onclick = function () {
          toggleEntity('cour', 'state-cour');
      };

      // Event Listener for Gate
      document.getElementById('toggle-gate').onclick = toggleGate;

      // Initial state updates
      updateState('cuisine', 'state-cuisine');
      updateState('cour', 'state-cour');
      updateState('gate_sensor', 'state-gate');

      // Auto-refresh every five seconds
      setInterval(function () {
          updateState('cuisine', 'state-cuisine');
          updateState('cour', 'state-cour');
          updateState('gate_sensor', 'state-gate');
      }, 5000); // Refresh every five seconds
    </script>
</body>
</html>
